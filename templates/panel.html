<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - Vitrina Digital</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/panel.css') }}">
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <h3>Procesando...</h3>
            <p>Por favor espere</p>
        </div>
    </div>

    <!-- Barra de Navegaci√≥n -->
    <nav class="nav-menu"><div><img src="/static/images/logo_.png" alt="Logo" class="logo">
            <a href="/dashboard">Dashboard</a>
            <a href="#sensors">Sensores</a>
            <a href="#background">Videos de Fondo</a>
        </div>
        <button onclick="handleLogout()" class="button">Cerrar Sesi√≥n</button>
    </nav>

    <!-- Contenido Principal -->
    <div class="container">
        <!-- Configuraci√≥n del Sistema -->
        <div class="card">        

            <h2>Configuraci√≥n del Sistema</h2>
            <div class="system-controls">
                <!-- Control Debug -->
                <div class="control-group">
                    <h3>Debug Panel</h3>
                    <button onclick="toggleDebugPanel()" class="button">
                        <span id="debug-status">Activar</span> Debug Panel
                    </button>
                    <p id="current-mode"></p>
                </div>
                
                <!-- Control Versus -->
                <div class="control-group">
                    <h3>Modo de Visualizaci√≥n</h3>
                    <select id="versus-mode" onchange="updateVersusMode()">
                        <option value="1">1 Sensor</option>
                        <option value="2">2 Sensores</option>
                        <option value="3">3 Sensores con Extra</option>
                        <option value="4">4 Sensores</option>
                    </select>
                </div>
        
                <!-- Configuraci√≥n Contenido Extra -->
                <div id="extra-content-section" class="control-group" style="display: none;">
                    <h3>Contenido Extra</h3>
                    <div class="extra-content-controls">
                        <select id="extra-position">
                            <option value="top-right">Superior Derecha</option>
                            <option value="top-left">Superior Izquierda</option>
                            <option value="bottom-right">Inferior Derecha</option>
                            <option value="bottom-left">Inferior Izquierda</option>
                        </select>
                        <input type="file" id="extra-content" accept="image/*,video/*">
                        <button onclick="updateExtraContent()" class="button">
                            Subir Contenido
                        </button>
                        <div class="extra-content-info"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gesti√≥n de Sensores -->
        <div class="card" id="sensors">
            <h2>Gesti√≥n de Sensores</h2>
            <div id="sensor-list" class="sensor-grid"></div>
        </div>

        <!-- Videos de Fondo -->
        <div class="card" id="background">
            <h2>Videos de Fondo</h2>
            <div class="input-group">
                <input type="file" id="background-video-upload" accept="video/*">
                <button onclick="uploadBackgroundVideo()" class="button">Subir Video</button>
            </div>
            <div id="background-video-list"></div>
        </div>
    </div>

    <!-- Modal de Preview -->
    <div id="preview-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePreview()">&times;</span>
            <video id="preview-video" controls></video>
        </div>
    </div>
    <div class="card container"> 
        <div class="monitor-container"> 
    
            <h2>Monitor del Sistema</h2>
            <link rel="stylesheet" href="{{ url_for('static', filename='css/monitor.css') }}"> 
    
            <div id="system-monitor">
            </div>
        </div>
    </div>
    <!-- Scripts -->
<!-- Scripts -->
<script src="/static/js/panel.js"></script>


<script type="text/babel">
    const { useState, useEffect } = React;
    
    const SystemMonitor = () => {
     const [systemInfo, setSystemInfo] = useState({
       cpu_percent: 0,
       mem_percent: 0,
       cpu_temp: 0,
       disk_percent: 0,
       uptime: '',
       swap_percent: 0
     });
    
     useEffect(() => {
       const ctx = document.getElementById('performanceChart');
       const chart = new Chart(ctx, {
         type: 'line',
         data: {
           labels: [],
           datasets: [{
             label: 'CPU',
             data: [],
             borderColor: '#3b82f6',
             backgroundColor: 'rgba(59, 130, 246, 0.1)',
             tension: 0.3,
             fill: true
           }, {
             label: 'Memoria',
             data: [],
             borderColor: '#10b981',
             backgroundColor: 'rgba(16, 185, 129, 0.1)',
             tension: 0.3,
             fill: true
           }]
         },
         options: {
           responsive: true,
           maintainAspectRatio: true,
           animation: false,
           plugins: {
             legend: {
               position: 'top',
               labels: {
                 usePointStyle: true,
                 padding: 15,
                 font: {
                   family: "'Inter', sans-serif",
                   size: 12
                 }
               }
             }
           },
           scales: {
             y: {
               beginAtZero: true,
               max: 100,
               grid: {
                 color: 'rgba(0,0,0,0.05)'
               },
               ticks: {
                 callback: value => value + '%',
                 font: {
                   family: "'Inter', sans-serif",
                   size: 11
                 }
               }
             },
             x: {
               grid: {
                 display: false
               },
               ticks: {
                 font: {
                   family: "'Inter', sans-serif",
                   size: 11
                 }
               }
             }
           }
         }
       });
    
       const updateInfo = async () => {
         try {
           const response = await fetch('/api/system_info');
           const data = await response.json();
           setSystemInfo(data);
           
           const time = new Date().toLocaleTimeString();
           chart.data.labels.push(time);
           chart.data.datasets[0].data.push(data.cpu_percent);
           chart.data.datasets[1].data.push(data.mem_percent);
           
           if (chart.data.labels.length > 20) {
             chart.data.labels.shift();
             chart.data.datasets.forEach(dataset => dataset.data.shift());
           }
           
           chart.update('none');
         } catch (error) {
           console.error('Error:', error);
         }
       };
    
       updateInfo();
       const interval = setInterval(updateInfo, 5000);
       return () => {
         clearInterval(interval);
         chart.destroy();
       };
     }, []);
    
     const StatCard = ({ title, value, icon, color }) => (
       <div className="bg-white rounded-lg p-6 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow">
         <div className="flex justify-between items-center">
           <div>
             <h3 className="text-gray-600 text-sm font-medium">{title}</h3>
             <p className="text-3xl font-bold mt-2 text-gray-800">{value}</p>
           </div>
           <div className={`${color} rounded-full p-3 text-2xl shadow-md`}>
             {icon}
           </div>
         </div>
       </div>
     );
    
     return (
       <div className="p-6 max-w-7xl mx-auto">
         <h2 className="text-2xl font-bold mb-6 text-gray-800">Monitor del Sistema</h2>
         
         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
           <StatCard 
             title="CPU" 
             value={`${systemInfo.cpu_percent}%`} 
             icon="üíª"
             color="bg-blue-500"
           />
           <StatCard 
             title="Memoria" 
             value={`${systemInfo.mem_percent}%`} 
             icon="üìä"
             color="bg-green-500"
           />
           <StatCard 
             title="Temperatura" 
             value={`${systemInfo.cpu_temp}¬∞C`} 
             icon="üå°Ô∏è"
             color="bg-red-500"
           />
           <StatCard 
             title="Disco" 
             value={`${systemInfo.disk_percent}%`} 
             icon="üíæ"
             color="bg-purple-500"
           />
           <StatCard 
             title="Tiempo Encendido" 
             value={systemInfo.uptime} 
             icon="‚è±Ô∏è"
             color="bg-orange-500"
           />
           <StatCard 
             title="Memoria Swap" 
             value={`${systemInfo.swap_percent}%`} 
             icon="üîÑ"
             color="bg-teal-500"
           />
         </div>
    
         <div className="bg-white p-6 rounded-lg shadow-lg border border-gray-100">
           <h3 className="text-lg font-semibold mb-4 text-gray-800">Historial de Rendimiento</h3>
           <div className="h-64 w-full">
             <canvas id="performanceChart"></canvas>
           </div>
         </div>
       </div>
     );
    };
    
    ReactDOM.render(
     <SystemMonitor />,
     document.getElementById('system-monitor')
    );
    </script>


</script>
</body>
</html>